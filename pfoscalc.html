<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel="stylesheet" href="styles.css">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Serum PFOS Calculator | UC Irvine</title>
    <h2>Serum PFOS Calculator for Adults</h2>
  </head>
  <body>
    <script></script>
    <noscript><B>JavaScript is off or not installed for this
    browser. This calculator requires JavaScript.</B><BR><BR></noscript>
    <B>
      Please enter the following values, then click on the "submit" button:
    </B>

    <table style="width:50%" border="1">
      <tr>
        <td> 
          <strong>Chemical</strong> 
        </td>
        <td> 
          <strong>Typical concentration for an adult with no exposure from water (&mu;g/L, ng/mL, or ppb) </strong> 
        </td>
        <td> 
          <strong>Contribution from other sources (ng/ml)</strong>
        </td>
      </tr>
      <tr>
        <td> PFOA </td>
        <td> 2 </td>
        <td> 2.08 </td>
      </tr>
      <tr>
        <td> PFOS </td>
        <td> 7 </td>
        <td> 7.07 </td>
      </tr>
      <tr>
        <td> *** </td>
        <td> *****  </td>
        <td> ***** </td>
      </tr>
      <tr>
        <td> *** </td>
        <td> *****  </td>
        <td> ***** </td>
      </tr>
    </table>

    <select type="text" id="menu" onchange = "changeText()">
      <option value="PFOS">PFOS</option>
      <option value="PFOA">PFOA</option>
      <option value="**">**</option>
      <option value="***">***</option>
    </select>

    <P>
      <main id="q1">
          1. How much PFOS was in your blood sample? (7 is a typical value for an adult with no PFOS in his or her water.) 
      </main>
      <aside style='display:inline-block' id="serumConc">
        Starting serum PFOS concentration (&mu;g/L, ng/mL, or ppb) 
      </aside>
      <input id="startserum" size="5">
    </P>
    <P>
      <main id="q2">
        2. How much PFOS is in your drinking water? Enter 0 if you're drinking only bottled water, carbon-filtered water, or water treated by reverse osmosis.
      </main>
      <aside style='display:inline-block' id="waterConc">
        Water PFOS concentration for ongoing consumption (ng/L, or ppt)
      </aside>
      <input id="waterconc" size="5">
    </P>
    <button type="button" onclick="ToggleAdv()"><I>Advanced options</I></button>
    <div id="advanced" style="display: none;">
      <P>
        <aside style='display:inline-block' id="ao1">
          Serum PFOS contribution from other ongoing exposures (ng/mL) 
        </aside>
        <input id='otherserum' value='7.07' size='5'>
        <aside style='display:inline-block' id="ao2">
          Half-life of PFOS in serum (years) 
        </aside>
        <input id='halflife' type='text' value='3.4' size='5'>
        <BR> Body Mass (kg) <input id='weight' value = '80' size='5'>
        <BR>Steady-state ratio for serum:water concentrations (unitless) <input id='ssratio' value='101.265' size='5'>
      </P>
    </div>
    <button type="button" name = "submitButton" onclick="myFunction()"><B>Submit</B></button>
    <p id="results"></p>
    <div class="card">
      <div class = "card-body" style = "width: 800px; height: 400px;">
        <canvas id="myChart"></canvas> 
      </div>
    </div>
  </body>

  <HR>
  Calculator Version 0.9 by Sherman Lu, <A HREF="http://www.faculty.uci.edu/profile.cfm?faculty_id=5377"> Scott Bartell, PhD </A>.  
  <p>
    <footer>
      THIS WEBSITE IS NOT INTENDED FOR THE PURPOSE OF PROVIDING MEDICAL ADVICE.  
      All content is for informational purposes only and is not intended to serve as a substitute for the consultation, diagnosis, and/or medical treatment of a qualified physician or healthcare provider. Calculations are based on average values for adults (ages 20 and over); individual results may vary due to individual differences in water consumption, PFOS excretion, and exposures from other sources. Model assumptions and defaults: one compartment pharmacokinetic model with 3.4 year serum half-life (<A HREF="https://www.ncbi.nlm.nih.gov/pubmed/29133598">Li Y et al., 2018</A>); 101.26 steady-state serum:water concentration ratio (<A HREF="http://ehp.niehs.nih.gov/1002503/">Hoffman et al., 2011</A>); 7.07 ng/mL serum contribution from other ongoing exposure sources (<A HREF="https://www.cdc.gov/exposurereport/">CDC, 2015</A>).        
    </footer>
  </p>
  

  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js" type="text/javascript"></script>
  <script>
  ToggleAdv = function() {
    extrastuff = document.getElementById('advanced');
    var isHidden = extrastuff.style.display == 'none';
    extrastuff.style.display = isHidden ? 'block' : 'none';
  };

  function changeText() {
        if (document.getElementById("menu").value == "PFOS") {
          document.getElementById("q1").innerHTML = 
            "1. How much PFOS was in your blood sample? (7 is a typical value for an adult with no PFOS in his or her water.) ";
          document.getElementById("serumConc").innerHTML = 
            "Starting serum PFOS concentration (&mu;g/L, ng/mL, or ppb) ";
          document.getElementById("q2").innerHTML = 
            "2. How much PFOS is in your drinking water? Enter 0 if you're drinking only bottled water, carbon-filtered water, or water treated by reverse osmosis.";
          document.getElementById("waterConc").innerHTML = 
            "Water PFOS concentration for ongoing consumption (ng/L, or ppt) ";
          document.getElementById("ao1").innerHTML = 
            "Serum PFOS contribution from other ongoing exposures (ng/mL)";
          document.getElementById("otherserum").value = "7.07";
          document.getElementById("ao2").innerHTML = "Half-life of PFOS in serum (years)";
          document.getElementById("halflife").value = "3.4";
        } else if (document.getElementById("menu").value == "PFOA") {
          document.getElementById("q1").innerHTML = 
            "1. How much PFOA was in your blood sample? (2 is a typical value for an adult with no PFOS in his or her water.) ";
          document.getElementById("serumConc").innerHTML = 
            "Starting serum PFOA concentration (&mu;g/L, ng/mL, or ppb) ";
          document.getElementById("q2").innerHTML = 
            "2. How much PFOA is in your drinking water? Enter 0 if you're drinking only bottled water, carbon-filtered water, or water treated by reverse osmosis.";
          document.getElementById("waterConc").innerHTML = 
            "Water PFOA concentration for ongoing consumption (ng/L, or ppt) ";
          document.getElementById("ao1").innerHTML = 
            "Serum PFOA contribution from other ongoing exposures (ng/mL)";
          document.getElementById("otherserum").value = "2.08";
          document.getElementById("ao2").innerHTML = "Half-life of PFOA in serum (years)";
          document.getElementById("halflife").value = "2.3";
        } else if (document.getElementById("menu").value == "**") {
            document.getElementById("divText").innerHTML = "[HEADER] ...";
        } else if (document.getElementById("menu").value == "***") {
            document.getElementById("divText").innerHTML = "NOTE [DATE] ...";
        }
  };

  function myFunction() {
    var ctx = document.getElementById("myChart");
    C0 = Number(document.getElementById("startserum").value); //Co
    Cw = Number(document.getElementById("waterconc").value); //W
    Cother = Number(document.getElementById("otherserum").value); //Background = 7.07 ng/L
    hl = Number(document.getElementById("halflife").value); //t_1/2
    //ss = Number(document.getElementById("ssratio").value); //Sw = ing_rate/kv
    w = Number(document.getElementById("weight").value);
    ss = ((13*w*365.25)/1000) * (3.4/Math.log(2)) * (1/(0.23*w));
    //ing_rate = 13 mL/kg-day, assume 80 kg on average
    //k = ln(2)/half_life = ln(2)/3.4 years
    //v = vol. of dist. = 0.23 L/kg = 230 mL/kg
    //Sw = ((13*(80kg)*365.25)/1000) * (3.4/ln(2)) * (1/(0.23*80)) = 101.265
    tend = 25;
    points = [];
    x_axis = [];
    k = (Math.log(2)/hl)
    kv = k*230;
    Cinf = Cother + (Cw*ss/1000);
    for (i = 1; i <= tend; i++){
      Ct = Cinf + (C0 -Cinf)*Math.exp(-k*i);
      x_axis.push(i);
      points.push(Ct);
    }
    if (isNaN(C0) || C0 < 0 || isNaN(Cw) || Cw < 0 || isNaN(hl) || hl < 0 || 
      isNaN(Cother) || Cother < 0 || isNaN(ss) || ss < 0) {
      alert("Please enter only non-negative numbers");
      document.getElementById('chart_div').style.visibility ='hidden';
      document.getElementById("chart_div").style.height = "0px";
      output = "";
    } else {
      if (Cother > C0 + 0.1) {
        alert("Starting serum PFOA concentration is lower than assumed contribution from other sources; calculations may not be accurate for that situation.")
      }
      var myChart = new Chart(document.getElementById("myChart").getContext('2d'), {
          type: 'line',
          data: {
              labels: x_axis,
              datasets: [{
                  data: points,
                  borderColor: "#3e95cd",
                  fill: false,
              }]
          },
          options: {
            scales: {
              xAxes: [{
                scaleLabel: {
                  display: true,
                  labelString: "Time (years)"
                }
              }],
              yAxes: [{
                scaleLabel: {
                  display: true,
                  labelString: "Serum PFOS (ng/ml)"
                }
              }]
            },
            legend: {
              display: false
            },
            responsive: true,
            maintainAspectRatio: false
          }
        });

      output = "Starting serum PFOS concentration: " + C0 + " ng/mL <BR>" +
      "Water PFOS concentration: " + Cw + " ppt <BR>" +
      "Serum PFOS contribution from other ongoing exposures: " + Cother + " ng/mL <BR>" +
      "Half-life of PFOS in serum: " + hl + " years <BR>" +
      "Weight of Subject: " + w + " kg <BR>" +
      "Steady-state ratio for serum:water concentrations: " + (Math.round(100*ss)/100) + "<BR>" +
            "Predicted steady-state serum PFOS concentration: " + (Math.round(100*Cinf)/100) + " ng/mL";
      document.getElementById("results").innerHTML = output;
    }
  };
  </script>
</html>
